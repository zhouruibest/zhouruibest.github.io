# 根据流量推算存储容量和投入成本
通常来说，一个高并发网站高峰期核心 API 的 QPS 在 30W 左右，我们按每天 8 个小时来计算，并且假定每次核心接口请求都会产生 1KB 日志，这样的话每天的请求量和每天的日志数据量就可以这样计算：

```
每天请求量 =3600 秒 X 8 小时 X 300000 QPS = 8 640 000 000 次请求 / 天 = 86 亿次请求 / 天
每天日志数据量：8 640 000 000 X 1KB => 8.6TB/ 天
```

根据上面的算式可以直观看到，如果我们的单次请求产生 1KB 日志的话，那么每天就有 8T 的日志需要做抓取、传输、整理、计算、存储等操作。为了方便追溯问题，我们还需要设定日志保存的周期，这里按保存 30 天计算，那么一个月日志量就是 258TB 大小的日志需要存储，计算公式如下：8.6TB X 30 天 = 258 TB /30 天

那么，如果不增增加日志服务器，如何节省存储成本？

我们可以从节省服务器存储量或者降低日志量这两个思路入手，比如后面这些方式：
- 减少我们保存日志的周期，从保存 30 天改为保存 7 天，可以节省四分之三的空间；
- 非核心业务和核心业务的日志区分开，非核心业务只存 7 天，核心业务则存 30 天；
- 减少日志量，这需要投入人力做分析。可以适当缩减稳定业务的排查日志的输出量；
- 如果服务器多或磁盘少，服务器 CPU 压力不大，数据可以做压缩处理，可以节省一半磁盘；

上面这些临时方案，确实可以解决我们一时的燃眉之急。不过在节约成本的时候，建议不要牺牲业务服务，尤其是核心业务。

接下来，我们就来讨论一种特殊情况。如果业务高峰期的流量激增，远超过 30W QPS，就有更多流量瞬间请求尖峰，或者出现大量故障的情况。这时甚至没有报错服务的日志中心也会被影响，开始出现异常。**高峰期日志会延迟半小时**，甚至是一天，最终后果就是系统报警不及时，即便排查问题，也查不到实时故障情况，这会严重影响日志中心的运转。

出现上述情况，是**因为日志中心普遍采用共享的多租户方式，隔离性很差**。这时候个别系统的日志会疯狂报错，占用所有日志中心的资源。为了规避这种风险，一些核心服务通常会独立使用一套日志服务，和周边业务分离开，保证对核心服务的及时监控。