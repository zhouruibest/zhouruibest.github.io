# 整体架构

架构中主要的模块有DockerClient、DockerDaemon、DockerRegistry、Graph、Driver、Libcontainer和Docker Container

![](./docker整体架构.png)

## DockerClient

一般以unix://path_to_socket和DockerDaemon（包含Docker Server， Engine，Job）中的Docker Server通信

## DockerDaemon

### Docker Server

Docker Server是DockerDaemon的众多Job中的一个比较特殊的一个，名为"serveapi"

![](./docker-server架构示意图.png)

### Engine

存储容器信息，管理Job执行

关键数据结构`handlers`

### Job

Job有一个名称，有运行时参数、环境变量、标准输入、标准输出、标准错误、返回状态等等

## Docker Registry

容器竞相是用来在容器创建时初始化容器的rootfs文件系统内容

## Graph

是容器镜像的保管者。不管是下载的镜像，还是构建的镜像，都由Graph统一管理。Docker支持不同的镜像存储方案，如aufs、devicemapper、btrfs

## Driver

驱动模块。实现对Docker运行环境的定制。

为了将仅与Docker容器有关的管理从DockerDaemon的所有逻辑中区分开来，Docker的设计者设计了Driver层来抽象不同类别各自的功能范畴。

主要包含了以下三类驱动

### graphdriver

主要负责容器镜像的管理

- 从远程的Docker Registry下载镜像并进行存储
- 本地构建完成镜像之后的存储
- 为容器准备rootfs

![](./graphdriver结构示意图.png)

在graphdriver的初始化过程之前，有四种文件系统或者文件系统的驱动Driver在DockerDaemon内部注册，它们分别是aufs、btrfs、vfs和devmapper。

aufs、btrfs和devmapper用于容器镜像的管理；vfs用于volume的管理。

overlay、overlay2是aufs的升级方案



### networkdriver

### execdriver

